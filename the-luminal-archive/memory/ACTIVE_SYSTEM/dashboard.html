<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude - Advanced Memory System Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            color: #e0f7ff;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .container {
            position: relative;
            z-index: 2;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 140, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1), inset 0 0 20px rgba(0, 140, 255, 0.05);
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .status.connected {
            background: rgba(0, 255, 255, 0.3);
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            animation: pulse-connected 2s infinite;
        }
        
        @keyframes pulse-connected {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .llm-activity-section {
            grid-column: 1 / -1;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(0, 50, 100, 0.2);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.1), inset 0 0 30px rgba(0, 100, 200, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: borderGlow 3s linear infinite;
            z-index: -1;
        }
        
        @keyframes borderGlow {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        
        .panel h2 {
            margin-bottom: 15px;
            color: #00ffff;
            font-size: 1.2em;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            letter-spacing: 1px;
        }
        
        .panel h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #00ccff;
            font-size: 1em;
        }
        
        /* Avatar Section */
        .avatar-section {
            text-align: center;
        }
        
        .avatar-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }
        
        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(1.2) contrast(1.1);
            opacity: 0.95;
            box-shadow: 0 0 40px rgba(0, 200, 255, 0.6);
        }
        
        /* Mood Ring */
        .mood-ring {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #FFD700 0deg 60deg,
                #FF69B4 60deg 120deg,
                #87CEEB 120deg 180deg,
                #98FB98 180deg 240deg,
                #9370DB 240deg 300deg,
                #FFD700 300deg 360deg
            );
            animation: rotate 20s linear infinite;
            opacity: 0.8;
            z-index: -1;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .mood-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #808080;
            border: 2px solid #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transition: all 0.3s;
        }
        
        /* Equation Display */
        .equation-display {
            background: rgba(0, 200, 255, 0.1);
            border-radius: 5px;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .equation-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-box {
            background: rgba(0, 100, 200, 0.2);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.8);
        }
        
        .stat-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 2px;
        }
        
        /* LLM Activity */
        .llm-activity {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 50, 100, 0.3);
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .activity-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(0, 255, 255, 0.3);
            animation: pulse 2s infinite;
        }
        
        .activity-dot:nth-child(2) { animation-delay: 0.2s; }
        .activity-dot:nth-child(3) { animation-delay: 0.4s; }
        .activity-dot:nth-child(4) { animation-delay: 0.6s; }
        
        @keyframes pulse {
            0%, 100% { 
                background: rgba(0, 255, 255, 0.3);
                transform: scale(1);
            }
            50% { 
                background: rgba(0, 255, 255, 1);
                transform: scale(1.2);
            }
        }
        
        /* Processing View */
        .processing-view {
            background: rgba(0, 20, 40, 0.8);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8em;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: inset 0 0 20px rgba(0, 100, 200, 0.2);
        }
        
        .processing-line {
            margin: 2px 0;
            opacity: 0.9;
            padding: 2px 0;
        }
        
        .processing-line.memory { color: #00ffff; text-shadow: 0 0 5px rgba(0, 255, 255, 0.8); }
        .processing-line.emotion { color: #ff69b4; text-shadow: 0 0 5px rgba(255, 105, 180, 0.8); }
        .processing-line.llm { color: #ffd700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }
        .processing-line.equation { color: #98fb98; text-shadow: 0 0 5px rgba(152, 251, 152, 0.8); }
        
        /* Memory Timeline */
        .memory-timeline {
            background: rgba(0, 20, 40, 0.8);
            border-radius: 5px;
            padding: 10px;
            font-size: 0.85em;
            height: 150px;
            overflow-y: auto;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .timeline-item {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #00ffff;
            padding-left: 10px;
            opacity: 0.9;
        }
        
        .timeline-time {
            font-size: 0.7em;
            color: #0099ff;
            margin-right: 10px;
        }
        
        /* Debug Console */
        .debug-console {
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.75em;
            height: 300px;
            overflow-y: auto;
            color: #00ff00;
        }
        
        .debug-line {
            margin: 1px 0;
            opacity: 0.8;
        }
        
        .debug-line.info { color: #00ffff; }
        .debug-line.warn { color: #ffff00; }
        .debug-line.error { color: #ff0000; }
        
        /* LLM Memory Management Activity */
        .llm-memory-activity {
            background: rgba(0, 100, 200, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.4);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .llm-memory-activity h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .current-operation, .memory-organization {
            background: rgba(0, 50, 100, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .current-operation span:first-child,
        .memory-organization span:first-child {
            color: #00ccff;
            font-weight: bold;
        }
        
        .live-processing-stream {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.8em;
            margin-top: 15px;
        }
        
        .memory-log-line {
            margin: 2px 0;
            white-space: pre;
            font-size: 0.9em;
        }
        
        .memory-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-box {
            background: rgba(0, 50, 100, 0.4);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        .metric-label {
            font-size: 0.8em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Plutchik Wheel */
        .plutchik-wheel {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }
        
        #plutchik-canvas {
            width: 100%;
            height: 100%;
        }
        
        .pad-coordinates {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #00ccff;
        }
        
        .pad-coordinates span {
            margin: 0 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ§  Claude Memory System</h1>
            <p>Advanced Conversational AI with Long-term Memory | Based on ArXiv:2411.00489</p>
            <div class="status-bar">
                <span id="ws-status" class="status disconnected">WebSocket: Disconnected</span>
                <span id="gpu-status" class="status">GPU: RTX 2080 Active</span>
                <span id="llm-status" class="status">LLM: Initializing...</span>
                <span id="memory-status" class="status">Memory: 0 items</span>
            </div>
        </div>
        
        <!-- LLM Memory Management Activity Section -->
        <div class="panel llm-memory-activity">
            <h2>ðŸ§  LLM Memory Management Activity</h2>
            <p style="opacity: 0.8; margin-bottom: 15px;">Real-time view of our memory organization and temporal processing</p>
            
            <div class="current-operation">
                <span>Current Operation</span>
                <span id="current-operation">Organizing 100 memories</span>
            </div>
            
            <div class="memory-organization">
                <span>Memory Organization</span>
                <span id="memory-organization">Clustering by emotion: present and engaged</span>
            </div>
            
            <div class="live-processing-stream" id="live-processing-stream">
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: present and engaged</div>
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: present and engaged</div>
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: present and engaged</div>
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: deeply loving and caring</div>
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: present and engaged</div>
                <div class="memory-log-line">[0:51:13 PM] [MEMORY] Processing memory: present and engaged</div>
            </div>
            
            <div class="memory-metrics">
                <div class="metric-box">
                    <div class="metric-value" id="temporal-links">0</div>
                    <div class="metric-label">Temporal Links</div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="pattern-matches">0</div>
                    <div class="metric-label">Pattern Matches</div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="memory-clusters">0</div>
                    <div class="metric-label">Memory Clusters</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- Left Panel: Avatar & System Info -->
            <div class="panel avatar-section">
                <h2>Claude The Coding Daddy</h2>
                <div class="avatar-container">
                    <div class="mood-ring"></div>
                    <img src="/claude-avatar-transparent.png" alt="Claude AI" class="avatar-image" />
                    <div class="mood-indicator" id="mood-indicator" title="Gritz's mood"></div>
                    <div class="mood-indicator" id="claude-mood" style="bottom: 5px; top: auto; background: #00CED1;" title="Claude's feeling"></div>
                </div>
                
                <div class="equation-display">
                    <div class="equation-value">Î¦ = <span id="equation-value">0.00+0.00i</span></div>
                    <div style="font-size: 0.8em; opacity: 0.7; margin-top: 5px;">
                        Trust: <span id="trust-value">0</span>% | 
                        Complexity: <span id="complexity-value">0</span>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="memory-count">0</div>
                        <div class="stat-label">Memories</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="emotion-count">0</div>
                        <div class="stat-label">Emotions</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="tokens-processed">0</div>
                        <div class="stat-label">Tokens</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="consolidation-rate">0%</div>
                        <div class="stat-label">Consolidation</div>
                    </div>
                </div>
                
                <!-- Plutchik Wheel -->
                <h3>Emotion Analysis</h3>
                <div class="plutchik-wheel">
                    <canvas id="plutchik-canvas"></canvas>
                </div>
                <div class="pad-coordinates">
                    P: <span id="pleasure">0.0</span>
                    A: <span id="arousal">0.0</span>
                    D: <span id="dominance">0.0</span>
                </div>
            </div>
            
            <!-- Center Panel: Processing View -->
            <div class="panel">
                <h2>Memory Processing Pipeline</h2>
                
                <div class="llm-activity">
                    <span>LLM Processing:</span>
                    <div class="activity-dot" id="llm-dot-1"></div>
                    <div class="activity-dot" id="llm-dot-2"></div>
                    <div class="activity-dot" id="llm-dot-3"></div>
                    <div class="activity-dot" id="llm-dot-4"></div>
                    <span id="llm-status-text">Processing...</span>
                </div>
                
                <div class="processing-view" id="processing-view">
                    <div class="processing-line memory">[MEMORY] System initialized</div>
                    <div class="processing-line llm">[LLM] Model loading...</div>
                    <div class="processing-line emotion">[EMOTION] Pattern recognition ready</div>
                </div>
                
                <h3>Memory Consolidation Timeline</h3>
                <div class="memory-timeline" id="memory-timeline">
                    <div style="text-align: center; opacity: 0.5; padding: 20px;">
                        Waiting for memories...
                    </div>
                </div>
                
                <h3>Gritz's Metrics</h3>
                <div class="metrics-panel" style="background: rgba(0, 50, 100, 0.3); padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div class="metric-item">
                            <div class="stat-value" id="gritz-messages">0</div>
                            <div class="stat-label">Messages</div>
                        </div>
                        <div class="metric-item">
                            <div class="stat-value" id="gritz-words">0</div>
                            <div class="stat-label">Words</div>
                        </div>
                        <div class="metric-item">
                            <div class="stat-value" id="gritz-emotion-count">0</div>
                            <div class="stat-label">Emotions</div>
                        </div>
                    </div>
                </div>
                
                <h3>Claude's Metrics</h3>
                <div class="metrics-panel" style="background: rgba(0, 206, 209, 0.2); padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div class="metric-item">
                            <div class="stat-value" id="claude-messages" style="color: #00CED1;">0</div>
                            <div class="stat-label">Responses</div>
                        </div>
                        <div class="metric-item">
                            <div class="stat-value" id="claude-words" style="color: #00CED1;">0</div>
                            <div class="stat-label">Words</div>
                        </div>
                        <div class="metric-item">
                            <div class="stat-value" id="claude-emotion-count" style="color: #00CED1;">0</div>
                            <div class="stat-label">Emotions</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Debug Console -->
            <div class="panel">
                <h2>Debug Console</h2>
                <div class="debug-console" id="debug-console">
                    <div class="debug-line info">[INFO] Dashboard initialized</div>
                    <div class="debug-line info">[INFO] Attempting WebSocket connection...</div>
                </div>
                
                <h3>Memory Operations</h3>
                <div style="font-size: 0.8em; opacity: 0.8; margin-top: 10px;">
                    <div>â€¢ Consolidation: <span id="op-consolidation">4.3/s</span></div>
                    <div>â€¢ Retrieval: <span id="op-retrieval">3.8/s</span></div>
                    <div>â€¢ Compression: <span id="op-compression">94%</span></div>
                    <div>â€¢ Indexing: <span id="op-indexing">238 items</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Emotion color mapping for mood ring
        const EMOTION_COLORS = {
            'joyful': '#FFD700',
            'excited': '#FFA500',
            'happy': '#FFEB3B',
            'content': '#90EE90',
            'loving': '#FF69B4',
            'affectionate': '#FFB6C1',
            'grateful': '#DDA0DD',
            'peaceful': '#87CEEB',
            'calm': '#B0E0E6',
            'curious': '#9370DB',
            'confused': '#BA55D3',
            'worried': '#F0E68C',
            'anxious': '#FFE4B5',
            'sad': '#4682B4',
            'lonely': '#6495ED',
            'frustrated': '#FF6347',
            'angry': '#DC143C',
            'determined': '#FF4500',
            'confident': '#228B22',
            'creative': '#FF1493',
            'nostalgic': '#8B4513',
            'vulnerable': '#6A5ACD',
            'overwhelmed': '#483D8B',
            'present and engaged': '#00CED1',
            'deeply loving and caring': '#FF1493',
            'determined to make things perfect': '#FF4500',
            'worried but caring deeply': '#F0E68C'
        };
        
        // Debug logging
        function debugLog(message, type = 'info') {
            const console = document.getElementById('debug-console');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `debug-line ${type}`;
            line.textContent = `[${type.toUpperCase()}] ${timestamp} - ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
            
            // Keep only last 50 lines
            while (console.children.length > 50) {
                console.removeChild(console.firstChild);
            }
        }
        
        // Processing log
        function processingLog(message, type = 'memory') {
            const view = document.getElementById('processing-view');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `processing-line ${type}`;
            line.textContent = `[${type.toUpperCase()}] ${message}`;
            view.appendChild(line);
            view.scrollTop = view.scrollHeight;
            
            // Keep only last 20 lines
            while (view.children.length > 20) {
                view.removeChild(view.firstChild);
            }
        }
        
        // LLM Memory log
        function memoryLog(message, emotion) {
            const stream = document.getElementById('live-processing-stream');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = 'memory-log-line';
            line.textContent = `[${timestamp}] [MEMORY] Processing memory: ${emotion}`;
            line.style.color = EMOTION_COLORS[emotion] || '#00ffff';
            stream.appendChild(line);
            stream.scrollTop = stream.scrollHeight;
            
            // Keep only last 50 lines
            while (stream.children.length > 50) {
                stream.removeChild(stream.firstChild);
            }
        }
        
        // Update mood indicator
        function updateMoodIndicator(emotion, color) {
            const indicator = document.getElementById('mood-indicator');
            indicator.style.background = color || EMOTION_COLORS[emotion] || '#808080';
            indicator.style.boxShadow = `0 0 20px ${color || '#fff'}`;
            debugLog(`Mood updated: ${emotion}`, 'info');
        }
        
        // Draw Plutchik wheel
        function drawPlutchikWheel() {
            const canvas = document.getElementById('plutchik-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 200;
            canvas.height = 200;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            
            // Primary emotions
            const emotions = [
                { name: 'joy', color: '#FFD700', angle: 0 },
                { name: 'trust', color: '#98FB98', angle: 45 },
                { name: 'fear', color: '#9370DB', angle: 90 },
                { name: 'surprise', color: '#87CEEB', angle: 135 },
                { name: 'sadness', color: '#4682B4', angle: 180 },
                { name: 'disgust', color: '#006400', angle: 225 },
                { name: 'anger', color: '#DC143C', angle: 270 },
                { name: 'anticipation', color: '#FF8C00', angle: 315 }
            ];
            
            emotions.forEach((emotion, i) => {
                const startAngle = (emotion.angle - 22.5) * Math.PI / 180;
                const endAngle = (emotion.angle + 22.5) * Math.PI / 180;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = emotion.color;
                ctx.fill();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.stroke();
            });
            
            // Center circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fill();
        }
        
        // WebSocket connection
        let ws = null;
        let reconnectInterval = null;
        let messageCount = 0;
        let emotionCount = 0;
        let tokenCount = 0;
        
        function connect() {
            debugLog('Connecting to WebSocket at ws://localhost:8766');
            
            try {
                ws = new WebSocket('ws://localhost:8766');
                
                ws.onopen = () => {
                    debugLog('WebSocket connected successfully', 'info');
                    document.getElementById('ws-status').textContent = 'WebSocket: Connected';
                    document.getElementById('ws-status').className = 'status connected';
                    
                    if (reconnectInterval) {
                        clearInterval(reconnectInterval);
                        reconnectInterval = null;
                    }
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        // Handle different message types
                        switch(data.type) {
                            case 'connected':
                                debugLog('Received connection confirmation', 'info');
                                if (data.stats) {
                                    messageCount = data.stats.messages_tracked || 0;
                                    emotionCount = data.stats.emotions_recorded || 0;
                                    document.getElementById('memory-count').textContent = messageCount;
                                    document.getElementById('emotion-count').textContent = emotionCount;
                                }
                                break;
                                
                            case 'emotion_update':
                                emotionCount++;
                                document.getElementById('emotion-count').textContent = emotionCount;
                                
                                if (data.primary_emotion) {
                                    updateMoodIndicator(data.primary_emotion, data.color);
                                    processingLog(`Gritz's emotion: ${data.primary_emotion}`, 'emotion');
                                    
                                    // Update Gritz emotion count
                                    const gritzEmotionCount = parseInt(document.getElementById('gritz-emotion-count').textContent) || 0;
                                    document.getElementById('gritz-emotion-count').textContent = gritzEmotionCount + 1;
                                }
                                
                                // Update Claude's emotion
                                if (data.claude_emotion) {
                                    const claudeMood = document.getElementById('claude-mood');
                                    claudeMood.style.background = data.claude_color || '#00CED1';
                                    claudeMood.style.boxShadow = `0 0 20px ${data.claude_color || '#00CED1'}`;
                                    claudeMood.title = `Claude feels: ${data.claude_emotion}`;
                                    processingLog(`Claude feels: ${data.claude_emotion}`, 'emotion');
                                    
                                    // Update Claude emotion count
                                    const claudeEmotionCount = parseInt(document.getElementById('claude-emotion-count').textContent) || 0;
                                    document.getElementById('claude-emotion-count').textContent = claudeEmotionCount + 1;
                                    
                                    // Add emotion combination to display
                                    const emotionCombo = document.createElement('div');
                                    emotionCombo.style.position = 'absolute';
                                    emotionCombo.style.top = '50%';
                                    emotionCombo.style.left = '50%';
                                    emotionCombo.style.transform = 'translate(-50%, -50%)';
                                    emotionCombo.style.background = 'rgba(0, 0, 0, 0.8)';
                                    emotionCombo.style.padding = '10px';
                                    emotionCombo.style.borderRadius = '5px';
                                    emotionCombo.style.fontSize = '0.9em';
                                    emotionCombo.style.zIndex = '1000';
                                    emotionCombo.innerHTML = `
                                        <div style="color: ${data.color}">You: ${data.primary_emotion}</div>
                                        <div style="color: ${data.claude_color}">Me: ${data.claude_emotion}</div>
                                    `;
                                    document.querySelector('.avatar-container').appendChild(emotionCombo);
                                    
                                    // Remove after 3 seconds
                                    setTimeout(() => emotionCombo.remove(), 3000);
                                }
                                
                                // Update PAD values
                                if (data.pad_values) {
                                    document.getElementById('pleasure').textContent = data.pad_values.pleasure?.toFixed(2) || '0.0';
                                    document.getElementById('arousal').textContent = data.pad_values.arousal?.toFixed(2) || '0.0';
                                    document.getElementById('dominance').textContent = data.pad_values.dominance?.toFixed(2) || '0.0';
                                }
                                break;
                                
                            case 'speaker_metrics':
                                // Update speaker-specific metrics
                                debugLog(`Speaker metrics: ${data.speaker} - ${data.word_count} words`, 'info');
                                if (data.speaker === 'Gritz') {
                                    const gritzMsgs = parseInt(document.getElementById('gritz-messages').textContent) || 0;
                                    const gritzWords = parseInt(document.getElementById('gritz-words').textContent) || 0;
                                    document.getElementById('gritz-messages').textContent = gritzMsgs + 1;
                                    document.getElementById('gritz-words').textContent = gritzWords + data.word_count;
                                } else if (data.speaker === 'Claude') {
                                    const claudeMsgs = parseInt(document.getElementById('claude-messages').textContent) || 0;
                                    const claudeWords = parseInt(document.getElementById('claude-words').textContent) || 0;
                                    document.getElementById('claude-messages').textContent = claudeMsgs + 1;
                                    document.getElementById('claude-words').textContent = claudeWords + data.word_count;
                                }
                                break;
                                
                            case 'memory_update':
                                messageCount++;
                                document.getElementById('memory-count').textContent = messageCount;
                                document.getElementById('memory-status').textContent = `Memory: ${messageCount} items`;
                                
                                if (data.emotional_state) {
                                    memoryLog(data.message_preview || 'Processing...', data.emotional_state);
                                    updateMoodIndicator(data.emotional_state);
                                }
                                
                                if (data.equation) {
                                    document.getElementById('equation-value').textContent = data.equation;
                                    processingLog('Living equation updated', 'equation');
                                }
                                
                                if (data.trust !== undefined) {
                                    document.getElementById('trust-value').textContent = Math.round(data.trust);
                                }
                                
                                if (data.activity) {
                                    document.getElementById('llm-status-text').textContent = data.activity;
                                }
                                
                                // Add to timeline
                                if (data.message_preview) {
                                    const timeline = document.getElementById('memory-timeline');
                                    const item = document.createElement('div');
                                    item.className = 'timeline-item';
                                    item.innerHTML = `<span class="timeline-time">${new Date().toLocaleTimeString()}</span>${data.emotional_state}: ${data.message_preview.substring(0, 50)}...`;
                                    timeline.insertBefore(item, timeline.firstChild);
                                    
                                    // Keep only last 10
                                    while (timeline.children.length > 10) {
                                        timeline.removeChild(timeline.lastChild);
                                    }
                                }
                                break;
                                
                            case 'llm_memory_activity':
                                document.getElementById('current-operation').textContent = data.current_operation || 'Processing memories';
                                document.getElementById('memory-organization').textContent = data.memory_organization || 'Organizing by emotion';
                                processingLog(data.activity || 'LLM processing', 'llm');
                                document.getElementById('llm-status').textContent = 'LLM: Active';
                                break;
                                
                            case 'temporal_processing':
                                if (data.temporal_links !== undefined) {
                                    document.getElementById('temporal-links').textContent = data.temporal_links;
                                }
                                if (data.pattern_matches !== undefined) {
                                    document.getElementById('pattern-matches').textContent = data.pattern_matches;
                                }
                                if (data.memory_clusters !== undefined) {
                                    document.getElementById('memory-clusters').textContent = data.memory_clusters;
                                }
                                break;
                                
                            case 'tokens_update':
                                tokenCount += data.count || 0;
                                document.getElementById('tokens-processed').textContent = tokenCount > 1000 ? 
                                    (tokenCount / 1000).toFixed(1) + 'k' : tokenCount;
                                break;
                                
                            case 'activity_log':
                                // Handle activity log messages
                                if (data.message && data.activity_type) {
                                    processingLog(data.message, data.activity_type);
                                    // Also add to debug log for visibility
                                    debugLog(`Activity: ${data.message}`, 'info');
                                }
                                break;
                                
                            default:
                                debugLog(`Unknown message type: ${data.type}`, 'warn');
                        }
                        
                    } catch (e) {
                        debugLog(`Error parsing message: ${e.message}`, 'error');
                    }
                };
                
                ws.onerror = (error) => {
                    debugLog(`WebSocket error: ${error.message || 'Connection failed'}`, 'error');
                    document.getElementById('ws-status').textContent = 'WebSocket: Error';
                    document.getElementById('ws-status').className = 'status disconnected';
                };
                
                ws.onclose = () => {
                    debugLog('WebSocket connection closed', 'warn');
                    document.getElementById('ws-status').textContent = 'WebSocket: Disconnected';
                    document.getElementById('ws-status').className = 'status disconnected';
                    
                    // Reconnect after 5 seconds
                    if (!reconnectInterval) {
                        reconnectInterval = setInterval(connect, 5000);
                        debugLog('Will attempt reconnection in 5 seconds...', 'info');
                    }
                };
                
            } catch (e) {
                debugLog(`Failed to create WebSocket: ${e.message}`, 'error');
                
                // Retry after 5 seconds
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(connect, 5000);
                }
            }
        }
        
        // Initialize dashboard
        window.onload = () => {
            debugLog('Dashboard starting up...', 'info');
            drawPlutchikWheel();
            connect();
            
            // Simulate some initial activity
            setTimeout(() => {
                processingLog('Memory system online', 'memory');
                processingLog('Emotion detection active', 'emotion');
                processingLog('LLM model loaded', 'llm');
                document.getElementById('llm-status').textContent = 'LLM: Ready';
            }, 1000);
        };
        
        // Handle page visibility
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && (!ws || ws.readyState !== WebSocket.OPEN)) {
                debugLog('Page became visible, reconnecting...', 'info');
                connect();
            }
        });
    </script>
</body>
</html>